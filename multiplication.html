<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
		<meta charset="utf-8">
			<meta name="viewport" content="width=device-width, initial-scale=1">
				<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
					<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
						<link rel="stylesheet" href="style.css">
							<script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
							
<script type="text/javascript">						
var ii = 0;

function drag(obj)
{
 var obj = document.getElementById(obj);
 var qo = obj.style.left;
 var po = obj.style.top; 
 var co = obj.style.backgroundColor;
 obj.orig_index=obj.style.zIndex;
 //设置当前对象永远显示在最上层
 obj.onmousedown=function (a){
  ii++;
  var div = document.createElement('div');   
      div.style.left = qo;
	  div.style.top = po;
	  div.style.height = obj.style.height;
	  div.style.width = obj.style.width;
	  div.style.backgroundColor = co;
	  div.style.position = "absolute";
	  div.style.border = "1px solid #F00";
      div.setAttribute("id", "newD"+ii);
	  document.body.appendChild(div);
	  drag("newD"+ ii);
 //鼠标按下
 this.style.cursor="move";
 //设置鼠标样式
 this.style.zIndex=1000;
  var d=document;
 if(!a) a=window.event;
 //按下时创建一个事件
 var x=a.clientX-document.body.scrollLeft-obj.offsetLeft;
 //x=鼠标相对于网页的x坐标-网页被卷去的宽-待移动对象的左外边距
 var y=a.clientY-document.body.scrollTop-obj.offsetTop;
 //y=鼠标相对于网页的y左边-网页被卷去的高-待移动对象的左上边距
 d.onmousemove=function(a){//鼠标移动
  if(!a) a=window.event;//移动时创建一个事件
  obj.style.left=a.clientX+document.body.scrollLeft-x;
  obj.style.top=a.clientY+document.body.scrollTop-y;
 }
 d.onmouseup=function (){//鼠标放开
  document.onmousemove=null;
  document.onmouseup = null;
  obj.style.zIndex = 1;
  obj.style.cursor="normal";//设置放开的样式
  var q = Math.round(obj.offsetLeft / 50) * 50;
  var p = Math.round(obj.offsetTop / 50) * 50;
  obj.style.left = q;
  obj.style.top =  p;
 }
 } 
}

</script>
							
						</head>
						<!-- Always shows a header, even in smaller screens. -->
						<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
							<header class="mdl-layout__header" id="navbar">
								<div class="mdl-layout__header-row">
									<!-- Title -->
									<span class="mdl-layout-title">Y2DHS Math Webapp</span>
									<!-- Add spacer, to align navigation to the right -->
									<div class="mdl-layout-spacer"></div>
									<!-- Navigation. We hide it in small screens. -->
									<nav class="mdl-navigation mdl-layout--large-screen-only">
										<a class="mdl-navigation__link" href="index.html">Home</a>
										<a class="mdl-navigation__link" href="summary.html">Summary</a>
										<a class="mdl-navigation__link" href="multiplication.html">Multiplication Frame</a>
									</nav>
								</div>
							</header>							
<body>
   <div class="mdl-layout__drawer mdl-layout--small-screen-only">
								<span class="mdl-layout-title">Y2DHS Math Webapp</span>
								<nav class="mdl-navigation">
									<a class="mdl-navigation__link" href="index.html">Home</a>
									<a class="mdl-navigation__link" href="summary.html">Summary</a>
									<a class="mdl-navigation__link" href="multiplication.html">Multiplication Frame</a>
								</nav>
							</div>
							<main class="mdl-layout__content">
								<div class="page-content">
									<div id="content">
											<form name="form1" action="" style="font-size:200%">
											<br>A / Coefficient of x<sup>2</sup><br>
											<div class="mdl-textfield mdl-js-textfield">
											<input class="mdl-textfield__input" type="text" pattern="-?[0-9]*(\.[0-9]+)?" id="sample1" name="ap">
											<label class="mdl-textfield__label" for="sample1">Number...</label>
											<span class="mdl-textfield__error">Input is not a number!</span>
											</div>
											<br><br>B / Coefficient of x<br>
											<div class="mdl-textfield mdl-js-textfield">
											<input class="mdl-textfield__input" type="text" pattern="-?[0-9]*(\.[0-9]+)?" id="sample2" name="bp">
											<label class="mdl-textfield__label" for="sample2">Number...</label>
											<span class="mdl-textfield__error">Input is not a number!</span>
											</div>
											<br><br>C / Constant<br>
											<div class="mdl-textfield mdl-js-textfield">
											<input class="mdl-textfield__input" type="text" pattern="-?[0-9]*(\.[0-9]+)?" id="sample3" name="cp">
											<label class="mdl-textfield__label" for="sample3">Number...</label>
											<span class="mdl-textfield__error">Input is not a number!</span>
											</div>										
											</form>
										<br>
										<button class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored" onclick="factorise(form1.ap.value,form1.bp.value,form1.cp.value)">
											<i class="material-icons">done</i>
										</button>
										<button class="mdl-button mdl-js-button mdl-button--fab mdl-button--colored" onclick="refresh()">
											<i class="material-icons">refresh</i>
										</button>
										<br><br>
										<div id="demo" style="font-size: 20px;line-height: 50px;}"></div>
										<canvas id="qw" width="1" height="1">
									</div>
									
							</main>
							</div>
<div id="div1" style="display: none; position:absolute; width:100px; height:100px; left:1000px; top:100px; background-color:#C8FFFF; border:1px solid #F00"> </div>
<div id="div2" style="display: none; position:absolute; width:100px; height:50px; left:1000px; top:220px; background-color:#C8FFFF; border:1px solid #F00"></div>
<div id="div3" style="display: none; position:absolute; width:50px; height:100px; left:1120px; top:100px; background-color:#C8FFFF; border:1px solid #F00"></div>
<div id="div4" style="display: none; position:absolute; width:50px; height:50px; left:1120px; top:220px; background-color:#C8FFFF; border:1px solid #F00"></div>

<script type="text/javascript">

 drag("div1");
 drag("div2");
 drag("div3");
 drag("div4");

</script>

</body>
	
<script>
var x1z,x1m,x2z,x2m = 0;
  var canvas = document.getElementById("qw");
  var ctx = canvas.getContext("2d");
  ctx.save();
  ctx.setTransform(1, 0, 0, 1, 0, 0);
  
//refresh
function refresh()
{location.reload(true);}
  
/*function factor(m)
  {
  if (m
																					<0) {h = -m;} else {h = m;}
  var n = [];var i = 2;var k = 1;
  n[0] = 1;
  while (h % i == 0) 
  {
    n[k] = i;
k++;
h = Math.floor(h/i) ;
  }
  i = 3;
  while (i < Math.round(Math.sqrt(Math.abs(m)))){
    while (h % i == 0)
{n[k] = i;
k++;
h = Math.floor(h/i);}
i = i + 2;
  }
  if (h > 1) {n[k] = h;}
  return n;
}*/

//find the roots of equation. Store the numerator and denominator.
function solve(q,w,e)
  {
  x1z = -w + Math.round(Math.sqrt(w * w- 4 * q * e));
  x1m = 2 * q;
  x2z = -w - Math.round(Math.sqrt(w * w- 4 * q * e));
  x2m = 2 * q;
}
//factorise(ax2+bx+c)
function factorise(a,b,c)
  {
  document.getElementById("demo").innerHTML ="";
  ctx.clearRect(0,0,canvas.width,canvas.height);  
  //judge the condition of a,b,c
  if (a == 0) {document.getElementById("demo").innerHTML = "Error."+"<br>"+"Please make sure A does not equal to 0.";return;}
  if (a % 1 != 0 || b % 1 != 0 || c % 1 != 0) {document.getElementById("demo").innerHTML ="Error."+"<br>"+"Please make sure all the coefficients are integer.";return;}
  if (b*b-4*a*c<0) {document.getElementById("demo").innerHTML ="Cannot factorise."+"<br>"+"Please make sure the discriminant is not smaller than 0.";return;}
  if (Math.sqrt(b*b-4*a*c) % 1 != 0) {document.getElementById("demo").innerHTML ="Sorry. The function fails to factorise the expression because the discriminant is not perfect square.";return;}
  //when b=c=0
  if (a != 1 && b == 0 && c == 0) {document.getElementById("demo").innerHTML =a+"x"+"<sup>2</sup>";}
  if (a == 1 && b == 0 && c == 0) {document.getElementById("demo").innerHTML ="x"+"<sup>2</sup>";}
  //ensure a is positive
  if (a<0) {document.getElementById("demo").innerHTML = document.getElementById("demo").innerHTML+"-";
  a = -a; b = -b; c = -c; var pin = -1;} else {var pin = 1;}
  solve(a,b,c);
  //record the result of factorisation
  x1z = x1z / x1m;
  x2z = x2z / x2m;
  var num = 1;
  while (x1z*num % 1 !=0) {num++;}
  x1z = x1z * num;
  x1m = num;
  num = 1;
  while (x2z*num % 1 !=0) {num++;}
  x2z = x2z * num;
  x2m = num;
  pin = pin * a/x1m/x2m;
  //output the result of factorisation
  if (c!=0 || b!=0){
  if (Math.abs(pin) != 1) {document.getElementById("demo").innerHTML = document.getElementById("demo").innerHTML+Math.abs(pin);}
  if (x1z != 0) {document.getElementById("demo").innerHTML = document.getElementById("demo").innerHTML+"(";}
  if (x1m != 1) {document.getElementById("demo").innerHTML = document.getElementById("demo").innerHTML+x1m+"x";} 
  else {document.getElementById("demo").innerHTML = document.getElementById("demo").innerHTML+"x";}
  
  if (x1z < 0) {document.getElementById("demo").innerHTML = document.getElementById("demo").innerHTML+"+"+ -x1z +")";}
  if (x1z > 0) {document.getElementById("demo").innerHTML = document.getElementById("demo").innerHTML+"-"+ x1z +")";}
  
  if (x2z != 0) {document.getElementById("demo").innerHTML = document.getElementById("demo").innerHTML+"(";}
  if (x2m != 1) {document.getElementById("demo").innerHTML = document.getElementById("demo").innerHTML+x2m+"x";}
   else {document.getElementById("demo").innerHTML = document.getElementById("demo").innerHTML+"x";}
  
  if (x2z < 0) {document.getElementById("demo").innerHTML = document.getElementById("demo").innerHTML+"+"+ -x2z +")";}
  if (x2z > 0) {document.getElementById("demo").innerHTML = document.getElementById("demo").innerHTML+"-"+ x2z +")";}
  }
  //output the illustration
  var xhg = pin * x1m;lhg = -pin * x1z;xsg = x2m;lsg = -x2z;
  line = xhg * 65 + lhg * 25;shu=xsg * 65 + lsg * 25;
  canvas.height = shu + 20;
  canvas.width = line;
  ctx.moveTo(0,0);
  if (xhg < 0 || lhg < 0 || xsg < 0 || lsg < 0) {return;}
  for (var yp = 0; yp <= xhg; yp++)
  {
    ctx.moveTo(yp * 65 ,0);
ctx.lineTo(yp * 65 ,shu);
ctx.stroke();
  }
  for (yp = xhg + 1; yp-xhg <= lhg; yp++ )
  {
    ctx.moveTo((yp-xhg) * 25 + xhg * 65,0);
ctx.lineTo((yp-xhg) * 25 + xhg * 65,shu);
ctx.stroke();
  }
  for (yp = 0; yp <= xsg; yp++)
  {
    ctx.moveTo(0,yp * 65);
ctx.lineTo(line,yp * 65);
ctx.stroke();
  }
  for (yp = xsg + 1; yp-xsg <= lsg; yp++)
  {
    ctx.moveTo(0,(yp-xsg) * 25 + xsg * 65);
ctx.lineTo(line,(yp-xsg) * 25 + xsg * 65);
ctx.stroke();
  }
  div1.style.display = "";
  div2.style.display = "";
  div3.style.display = "";
  div4.style.display = "";
}

</script>
</html>

